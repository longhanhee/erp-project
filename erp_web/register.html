<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta content="webkit" name="renderer"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
    <meta content="no-cache" http-equiv="Pragma"/>
    <meta http-equiv="Expires" content="0"/>
    <meta content="width=device-width, initial-scale=1, user-scalable=1" name="viewport"/>
    <title>注册 - 华夏ERP</title>
    <link rel="shortcut icon" href="images/favicon.ico" type="image/png">
    <script src="js/global.min.js?ctx=/js/a"></script>
    <script src="js/jquery/jquery-1.12.4.min.js"></script>
    <!-- <script src="js/static/jquery/jquery-migrate-1.4.1.min.js"></script> -->
    <!--[if lt IE 9]>
    <script src="js/common/h5fix.min.js"></script><![endif]-->
    <link rel="stylesheet" href="css/fonts/font-icons.min.css">
    <link rel="stylesheet" href="js/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="js/select2/4.0/select2.css">
    <link rel="stylesheet" href="js/icheck/1.0/minimal/grey.css">
    <link rel="stylesheet" href="js/adminlte/css/AdminLTE.min.css">
    <link rel="stylesheet" href="css/jsherp.css">
    <link rel="stylesheet" href="js/adminlte/css/skins/skin-blue-light2.css">
    <link rel="stylesheet" href="js/jquery-toastr/2.0/toastr.min.css">
    <link rel="stylesheet" href="js/modules/sys/sysRegister.css">
    <script type="text/javascript" src="js/jquery-1.8.0.min.js"></script>
    <script type="text/javascript" src="js/common/common.js"></script>
    <script type="text/javascript" src="js/md5/md5.js"></script>
    <script type="text/javascript" src="js/gVerify.js"></script>
</head>
<body class="hold-transition register-page">
<div class="wrapper">
    <!--[if lte IE 9]><a style="position:absolute;top:0;left:0;z-index:100000;display:block;width:100%;font-size:14px;
    color:#F00;text-decoration:none;background-color:#faffb3;text-align:center;"
        href="js/upbw/index.html" target="_blank">Phiên bản trình duyệt của bạn quá thấp hoặc ở chế độ tương thích, khiến tốc độ mở quá chậm. Để tăng tốc độ, bạn có thể chuyển sang chế độ tốc độ hoặc nâng cấp lên phiên bản mới nhất. Bấm vào đây để biết chi tiết.</a>
    <![endif]-->
    <!--[if lte IE 8]><script>window.location.href = 'js/upbw/index.html';</script><![endif]-->
    <!-- <link rel="stylesheet" href="js/static/icheck/1.0/square/blue.css"> -->
    <link rel="stylesheet" href="js/jquery-toastr/2.0/toastr.min.css">
    <link rel="stylesheet" href="js/modules/sys/sysLogin.css">
    <div class="register-box">
        <div class="register-logo">
            <a href="/">
                <b>ERP Trung Quốc</b>
                <small>V2.1</small>
            </a>
        </div>
        <div class="register-box-body">
            <div class="form-group has-feedback">
                <span class="glyphicon glyphicon-user form-control-feedback" title="Đăng nhập tài khoản"></span>
                <input type="text" id="username" name="username" class="form-control required"
                       data-msg-required="Vui lòng điền vào tài khoản đăng nhập." placeholder="Đăng nhập tài khoản (vui lòng nhập số điện thoại di động)"/>
            </div>
            <div class="form-group has-feedback">
                <span class="glyphicon glyphicon-lock form-control-feedback"
                      title="Đăng nhập mật khẩu, nhấn chuột để hiển thị mật khẩu"
                      onmousedown="$('#password').attr('type','text')"
                      onmouseup="$('#password').attr('type','password')">
                </span>
                <input type="password" id="password" name="password" class="form-control required"
                       data-msg-required="Vui lòng điền mật khẩu đăng nhập." placeholder="Mật khẩu đăng nhập" autocomplete="off"/>
            </div>
            <div class="form-group has-feedback">
                <span class="glyphicon glyphicon-lock form-control-feedback"
                      title="Đăng nhập mật khẩu, nhấn chuột để hiển thị mật khẩu"
                      onmousedown="$('#password').attr('type','text')"
                      onmouseup="$('#password').attr('type','password')">
                </span>
                <input type="password" id="confirmPassword" name="confirmPassword" class="form-control required"
                       data-msg-required="Vui lòng điền mật khẩu xác nhận." placeholder="Xác nhận mật khẩu" autocomplete="off"/>
            </div>
            <div class="form-group has-feedback" id="isValidCodeLogin">
                <div class="input-group">
                    <span class="input-group-addon">Mã xác minh：</span>
                    <input type="text" id="validCode" name="validCode" class="form-control" required="true"
                           data-msg-required="Vui lòng điền mã xác minh"  data-msg-remote="Mã xác minh không chính xác."/>
                    <span class="input-group-addon p0">
                        <div id="imgCaptcha" title="Nhấn vào đây để làm mới mã xác minh"></div>
                    </span>
                </div>
            </div>
            <div class="form-group">
                <input type="hidden" name="__url" value="">
                <button type="submit" class="btn btn-primary btn-block btn-flat"
                        id="btnSubmit" data-loading="Đăng ký xác minh thành công, nhập ..."
                        data-register-valid="Xin vui lòng chờ, xác minh đăng ký ...">Đăng ký ngay
                </button>
            </div>
            <div class="row">
                <div class="col-xs-12">
                    <a href="login.html" class="pull-left"><b>[ Đăng nhập ngay ]</b></a>
                    <div class="dropdown pull-right">
                        <a href="http://home.huaxiaerp.com/" class="dropdown-toggle" target="_blank">
                            <b><i class="fa icon-globe"></i> Trang web chính thức</b>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <div class="register-copyright">
            © 2015-2020
            <a style="color:#00458a;" href="https://www.huaxiaerp.com/" target="_blank">Hệ thống ERP</a>
            <a style="color:#00458a;" href="http://www.beian.miit.gov.cn" target="_blank">Su ICP số 19040373</a>
            <a style="color:#00458a;" href="https://gitee.com/jishenghua/JSH_ERP" target="_blank">ERP Trung Quốc</a>
            <a href='https://gitee.com/jishenghua/JSH_ERP/stargazers' target="_blank">
                <img src='https://gitee.com/jishenghua/JSH_ERP/badge/star.svg?theme=white' alt='star'></img>
            </a>
        </div>
    </div>
</div>
</body>

<script>
    $("#username, #password, #confirmPassword").on("focus blur", function () {
        var a = this;
        setTimeout(function () {
            var b = $(a).css("borderColor");
            if (b != "") {
                $(a).prev().css("color", b)
            }
        }, 100)
    }).blur();
    var verifyCode = new GVerify("imgCaptcha");
    //注册按钮绑定处理事件
    $("#btnSubmit").off("click").on("click", function () {
        if($("#validCode").val()) {
            var res = verifyCode.validate($("#validCode").val());
            if(res){
                var userName = $("#username");
                if(!userName.val()) {
                    alert("Tài khoản đăng nhập không thể để trống!");
                } else if(!isPhoneAvailable(userName)) {
                    alert("Vui lòng nhập đúng số điện thoại!");
                } else if(!$("#password").val()) {
                    alert("Mật khẩu đăng nhập không thể để trống!");
                } else if(!$("#confirmPassword").val()) {
                    alert("Xác nhận mật khẩu không được để trống!");
                } else if($("#password").val()!=$("#confirmPassword").val()) {
                    $("#confirmPassword").val("");
                    alert("Xác nhận mật khẩu không khớp!");
                } else {
                    //执行注册
                    $.ajax({
                        type: "post",
                        url: "/user/registerUser",
                        dataType: "json",
                        data: ({
                            loginame: $("#username").val(),
                            password: $("#password").val()
                        }),
                        success: function (res) {
                            if (res && res.code === 200) {
                                alert("Đăng ký thành công, vui lòng đăng nhập!");
                                location.href = "login.html";
                            } else {
                                alert(res.msg);
                                verifyCode.refresh(); //刷新
                            }
                        },
                        //此处添加错误处理
                        error: function () {
                            alert("Lỗi truy cập nền, vui lòng liên hệ với quản trị viên!");
                        }
                    });
                }
            } else{
                alert("Lỗi mã xác minh!");
            }
        } else {
            alert("Mã xác minh trống!");
        }
    });
</script>

</html>